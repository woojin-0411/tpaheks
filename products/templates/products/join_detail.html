{% extends "products/base.html" %}
{% block title %}{{ post.title }} | Q&A{% endblock %}
{% block content %}
<div class="container" style="padding-top: 150px; padding-bottom: 100px; max-width: 900px;">
    <div class="border-bottom pb-3 mb-4">
        <h4 class="fw-bold mb-3">{% if post.is_pinned %}<span class="text-danger">[공지]</span>{% endif %} {{ post.title }}</h4>
        <div class="d-flex justify-content-between align-items-center text-muted small">
            <div><span class="me-3"><i class="fas fa-user me-1"></i> {{ post.author_name }}</span><span><i class="far fa-clock me-1"></i> {{ post.created_at|date:"Y.m.d H:i" }}</span></div>
            <button class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#delModal"><i class="fas fa-trash-alt"></i> 삭제</button>
        </div>
    </div>
    <div class="py-3 mb-5" style="min-height: 200px;">
        {% if post.images.exists %}
            <div class="mb-4">
                {% for img_obj in post.images.all %}
                    <img src="{{ img_obj.image.url }}" class="img-fluid rounded mb-2" alt="첨부 이미지" style="max-width: 100%; display:block;">
                {% endfor %}
            </div>
        {% endif %}
        
        <div style="white-space: pre-line; line-height: 1.8;">{{ post.content }}</div>
    </div>
    <div class="bg-light p-4 rounded mb-5">
        <h5 class="fw-bold border-bottom pb-2 mb-3"><i class="fas fa-comment-dots me-2"></i>답변</h5>
        {% for ans in post.answers.all %}
            <div class="d-flex mb-3"><div class="me-3"><span class="badge bg-primary">관리자</span></div><div><p class="mb-1 fw-bold" style="white-space: pre-line;">{{ ans.content }}</p><small class="text-muted">{{ ans.created_at|date:"Y.m.d H:i" }}</small></div></div><hr class="text-muted">
        {% empty %}<p class="text-muted text-center py-3">답변이 없습니다.</p>{% endfor %}
        <form method="post" action="{% url 'products:qna_answer_create' post.pk %}" class="mt-4">
            {% csrf_token %}
            <div class="input-group">
                <input type="password" name="admin_code" class="form-control" placeholder="관리자 코드 (4678)" style="max-width: 150px;" required>
                <input type="text" name="content" class="form-control" placeholder="답변 내용" required>
                <button class="btn btn-dark" type="submit">등록</button>
            </div>
        </form>
    </div>
    <div class="text-center"><a href="{% url 'products:qna' %}" class="btn btn-outline-secondary px-5">목록</a></div>
    <div class="modal fade" id="delModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">삭제</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><form method="post" action="{% url 'products:qna_action' post.pk %}">{% csrf_token %}<div class="modal-body"><p>관리자 코드를 입력하세요.</p><input type="password" name="admin_code" class="form-control text-center" required><input type="hidden" name="action_type" value="delete"></div><div class="modal-footer"><button type="submit" class="btn btn-danger">삭제</button></div></form></div></div></div>
</div>
{% endblock %}