{% extends "products/base.html" %}
{% load static %}
{% load humanize %}

{% block title %}ì»¤ìŠ¤í…€ ì—ë””í„° | {{ product.name }}{% endblock %}

{% block content %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">

<link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Do+Hyeon&family=Dokdo&family=Dongle&family=Gaegu&family=Gamja+Flower&family=Gowun+Batang&family=Gowun+Dodum&family=Gugi&family=Hi+Melody&family=Jua&family=Kirang+Haerang&family=Nanum+Brush+Script&family=Nanum+Gothic&family=Nanum+Myeongjo&family=Nanum+Pen+Script&family=Noto+Sans+KR&family=Noto+Serif+KR&family=Poor+Story&family=Single+Day&family=Song+Myung&family=Stylish&family=Sunflower&family=Yeon+Sung&family=Hahmlet&display=swap" rel="stylesheet">

<style>
    body { background-color: #f5f7fa; }
    .editor-container { max-width: 1400px; margin: 40px auto; padding: 0 20px; display: flex; gap: 40px; min-height: 850px; }
    
    .left-column { flex: 1.6; display: flex; flex-direction: column; gap: 20px; }
    /* [ìˆ˜ì •] ìº”ë²„ìŠ¤ ë˜í¼ ë° ì¸ì‡„ ì˜ì—­ ìŠ¤íƒ€ì¼ */
    .canvas-wrapper { 
        background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); 
        display: flex; justify-content: center; align-items: center; position: relative; 
        overflow: visible; border: 1px solid #eef0f2; min-height: 750px; /* ë†’ì´ ì•½ê°„ ì¦ê°€ */
    }
    .shirt-box { position: relative; width: 600px; height: 700px; background: #fff; }

    .base-shirt-img { 
        width: 100%; height: 100%; object-fit: contain; 
        position: absolute; top:0; left:0; z-index: 1; pointer-events: none; 
    }

    /* â˜… ì¸ì‡„ ì˜ì—­ ëŒ€í­ í™•ëŒ€ (ìƒí•˜ì¢Œìš° ì‹œì›í•˜ê²Œ) */
    .print-area-container {
        position: absolute; 
        top: 10%; left: 15%; /* ìœ„ì¹˜ ì¡°ì • */
        width: 70%; height: 80%; /* í¬ê¸° í™•ëŒ€ (ê¸°ì¡´ 50% -> 70%) */
        border: 1px dashed rgba(0,0,0,0.1); /* í‰ì†Œì—” íë¦¿í•˜ê²Œ */
        z-index: 10;
    }
    .print-area-container:hover { border-color: #ff6b00; } /* ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ ì˜ì—­ í‘œì‹œ */

    /* Fabric.js ìº”ë²„ìŠ¤ ìŠ¤íƒ€ì¼ */
    .canvas-container { margin: 0 auto; }
    .canvas-container canvas { outline: none; }
    .print-area { position: absolute; border: 2px dashed #ccc; z-index: 10; overflow: hidden; box-sizing: border-box; background-color: rgba(0, 0, 0, 0.02); }
    
    /* ë””ìì¸ ìš”ì†Œ & AI ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .design-obj { position: absolute; cursor: move; z-index: 20; border: 1px dashed transparent; }
    .design-obj.selected { border: 2px dashed #0d6efd; z-index: 30; } 
    .obj-controls { position: absolute; top: -45px; left: 50%; transform: translateX(-50%); display: none; gap: 5px; z-index: 100; width: max-content; background: #333; padding: 6px; border-radius: 6px; }
    .design-obj.selected .obj-controls { display: flex; }
    .btn-mini { background: #555; color: white; font-size: 11px; padding: 5px 10px; border-radius: 4px; cursor: pointer; white-space: nowrap; border: none; font-weight: bold; }
    .btn-mini.red { background: #ff4757; }
    .btn-mini.ai { background: #6c5ce7; } /* AI ë²„íŠ¼ ë³´ë¼ìƒ‰ */
    .btn-mini.restore { background: #27ae60; }
    
    .right-column { flex: 1; min-width: 350px; }
    .control-panel { background: white; border-radius: 15px; padding: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.03); border: 1px solid #eef0f2; position: sticky; top: 100px; }
    
    .view-controls { display: flex; gap: 10px; margin-top: 10px; }
    .view-btn { flex: 1; border: 2px solid #eee; border-radius: 10px; cursor: pointer; padding: 8px; text-align: center; background: white; transition: 0.2s; }
    .view-btn:hover { border-color: #ff6b00; transform: translateY(-2px); }
    .view-btn.active { border-color: #ff6b00; background: #fff5eb; box-shadow: 0 0 0 2px rgba(255,107,0,0.1); }
    .view-btn img { width: 40px; height: 40px; object-fit: contain; margin-bottom: 5px; display: block; margin: 0 auto; }
    .view-btn span { font-size: 12px; font-weight: bold; color: #555; }

    /* ëª¨ë‹¬ */
    .preview-grid-large { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
    .preview-item-large { text-align: center; background: #f9f9f9; border-radius: 10px; padding: 10px; border: 1px solid #eee; }
    .preview-shirt-wrap { 
    position: relative; 
    width: 100%; 
    aspect-ratio: 600 / 700; /* ì´ ë¹„ìœ¨ì´ í•µì‹¬ì…ë‹ˆë‹¤ */
    overflow: hidden; 
    margin: 0 auto; 
    background: #f9f9f9;
    }
    .preview-shirt-img { width: 100%; height: 100%; object-fit: contain; }
    .preview-scaler {
    position: absolute;
    top: 0;
    left: 0;
    width: 600px;  /* í¸ì§‘í™”ë©´ ì›ë³¸ í¬ê¸° */
    height: 700px; /* í¸ì§‘í™”ë©´ ì›ë³¸ í¬ê¸° */
    transform-origin: top left; /* ì™¼ìª½ ìœ„ ê¸°ì¤€ìœ¼ë¡œ ì¶•ì†Œ */
    pointer-events: none; /* í´ë¦­ ë°©ì§€ */
    }
    .btn-custom-order:hover {
        background-color: #e65c00 !important; /* ì•½ê°„ ë” ì§„í•œ ì£¼í™©ìƒ‰ */
        transform: translateY(-2px); /* ì‚´ì§ ìœ„ë¡œ ì˜¬ë¼ê°€ëŠ” íš¨ê³¼ */
        box-shadow: 0 6px 20px rgba(255, 107, 0, 0.4) !important;
    }
    /* ë”¥ ë¸”ë£¨ ê²°ì œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ì£¼í™©ìƒ‰ì˜ ë³´ìƒ‰ ê³„ì—´) */
    .btn-cta-blue {
        background-color: #004e92; /* ê¹Šì€ íŒŒë€ìƒ‰ */
        color: white;
        border: none;
        transition: all 0.3s;
    }
    .btn-cta-blue:hover {
        background-color: #0056b3; /* ì¡°ê¸ˆ ë” ë°ì€ íŒŒë€ìƒ‰ */
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 78, 146, 0.3);
    }
/* ìŠ¤í‹°ì»¤ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
    .sticker-box {
        display: grid;
        grid-template-columns: repeat(4, 1fr); /* í•œ ì¤„ì— 4ê°œ */
        gap: 10px;
        background: #f8f9fa;
        padding: 10px;
        border-radius: 10px;
        border: 1px solid #ddd;
        max-height: 150px;
        overflow-y: auto; /* ë§ìœ¼ë©´ ìŠ¤í¬ë¡¤ */
    }
    .sticker-btn {
        background: white;
        border: 1px solid #eee;
        border-radius: 8px;
        padding: 5px;
        cursor: pointer;
        transition: 0.2s;
        display: flex; align-items: center; justify-content: center;
    }
    .sticker-btn:hover {
        background: #fff3cd; /* ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ ë…¸ë€ìƒ‰ */
        border-color: #ffc107;
        transform: scale(1.1);
    }
    .sticker-btn img { width: 100%; height: auto; object-fit: contain; }
    @media (max-width: 991px) {
        .editor-container { flex-direction: column; }
        .preview-grid-large { grid-template-columns: repeat(2, 1fr); }
    }
</style>

<div class="editor-container">
    <div class="left-column">
        <div class="canvas-wrapper">
            <div class="shirt-box">
                <img id="shirt-img" src="" class="base-shirt-img">
                
                <div id="print-area-wrapper" class="print-area-container">
                    <canvas id="tshirt-canvas"></canvas>
                </div>
            </div>
        </div>
        
        <div class="design-toolbox mt-3">
            <div class="row g-3">
                <div class="col-md-6">
                    <div class="fw-bold mb-2"><i class="fas fa-smile me-2"></i>ê¾¸ë¯¸ê¸° ìŠ¤í‹°ì»¤</div>
                    
                    <div class="sticker-box mb-3">
                        <div class="sticker-btn" onclick="addSticker('{% static 'img/semodan_logo.png' %}')" title="ì„¸ëª¨ë‹¨ ë¡œê³ ">
                            <img src="{% static 'img/semodan_logo.png' %}">
                        </div>
                        
                        <div class="sticker-btn" onclick="addSticker('{% static 'img/heart.png' %}')">
                            <img src="{% static 'img/heart.png' %}" onerror="this.style.display='none'">
                        </div>

                        <div class="sticker-btn" onclick="addSticker('{% static 'img/star.png' %}')">
                            <img src="{% static 'img/star.png' %}" onerror="this.style.display='none'">
                        </div>

                        <div class="sticker-btn" onclick="addSticker('{% static 'img/smile.png' %}')">
                            <img src="{% static 'img/smile.png' %}" onerror="this.style.display='none'">
                        </div>

                        <div class="sticker-btn" onclick="addSticker('{% static 'img/flower.png' %}')">
                            <img src="{% static 'img/flower.png' %}" onerror="this.style.display='none'">
                        </div>
                    </div>

                    <button id="upload-btn" class="btn btn-dark w-100 py-2 fw-bold">
                        <i class="fas fa-upload me-2"></i>ë‚´ ì´ë¯¸ì§€ ë„£ì–´ë³´ê¸°
                    </button>                    
                    <input type="file" id="real-file-input" style="display:none;" accept="image/*" name="logo_file" form="quote-form" multiple>
                    <p class="text-muted small mt-1 mb-0">* ì´ë¯¸ì§€ ì„ íƒ ì‹œ [ëˆ„ë¼ ì œê±°] ë²„íŠ¼ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</p>
                </div>
                
                <div class="col-md-6">
                    <div class="fw-bold mb-2"><i class="fas fa-font me-2"></i>í…ìŠ¤íŠ¸ ì¶”ê°€</div>
                    <div class="input-group mb-2">
                        <input type="text" id="custom-text" class="form-control" placeholder="ë¬¸êµ¬ ì…ë ¥">
                        <button class="btn btn-outline-dark" onclick="addText()">ì¶”ê°€</button>
                    </div>
                    <div class="d-flex gap-2">
                        <select id="font-select" class="form-select form-select-sm" style="font-family: 'Noto Sans KR';">
                            <optgroup label="ê¹”ë”/ê³ ë”•">
                                <option value="'Noto Sans KR', sans-serif" selected>ë…¸í† ì‚°ìŠ¤ (ê¸°ë³¸)</option>
                                <option value="'Nanum Gothic', sans-serif">ë‚˜ëˆ”ê³ ë”•</option>
                                <option value="'Gowun Dodum', sans-serif">ê³ ìš´ë‹ì›€</option>
                                <option value="'Do Hyeon', sans-serif">ë„í˜„ì²´ (ë‘êº¼ì›€)</option>
                                <option value="'Jua', sans-serif">ì£¼ì•„ì²´ (ë™ê¸€ë™ê¸€)</option>
                                <option value="'Sunflower', sans-serif">í•´ë°”ë¼ê¸°</option>
                            </optgroup>

                            <optgroup label="ê°ì„±/ëª…ì¡°">
                                <option value="'Noto Serif KR', serif">ë…¸í† ì„¸ë¦¬í”„ (ëª…ì¡°)</option>
                                <option value="'Nanum Myeongjo', serif">ë‚˜ëˆ”ëª…ì¡°</option>
                                <option value="'Gowun Batang', serif">ê³ ìš´ë°”íƒ•</option>
                                <option value="'Song Myung', serif">ì†¡ëª…</option>
                                <option value="'Hahmlet', serif">í•¨ë ›</option>
                            </optgroup>

                            <optgroup label="ì†ê¸€ì”¨/ê·€ì—¬ì›€">
                                <option value="'Nanum Pen Script', cursive">ë‚˜ëˆ”íœê¸€ì”¨</option>
                                <option value="'Gaegu', cursive">ê°œêµ¬ìŸì´</option>
                                <option value="'Gamja Flower', cursive">ê°ìê½ƒ</option>
                                <option value="'Hi Melody', cursive">í•˜ì´ë©œë¡œë””</option>
                                <option value="'Single Day', cursive">ì‹±ê¸€ë°ì´</option>
                                <option value="'Poor Story', cursive">ì„œíˆ°ì´ì•¼ê¸°</option>
                                <option value="'Dongle', sans-serif">ë™ê¸€</option>
                            </optgroup>

                            <optgroup label="ë¶“ê¸€ì”¨/ê°œì„±">
                                <option value="'Black Han Sans', sans-serif">ë¸”ë™í•œì‚°ìŠ¤ (ê°•ë ¬í•¨)</option>
                                <option value="'Nanum Brush Script', cursive">ë‚˜ëˆ”ë¶“ê¸€ì”¨</option>
                                <option value="'Yeon Sung', cursive">ì—°ì„±ì²´</option>
                                <option value="'Dokdo', cursive">ë…ë„ì²´</option>
                                <option value="'Kirang Haerang', cursive">ê¸°ë‘í•´ë‘ (í†¡í†¡ íŠ)</option>
                                <option value="'Gugi', cursive">êµ¬ê¸°ì²´ (ë ˆíŠ¸ë¡œ)</option>
                                <option value="'Stylish', sans-serif">ìŠ¤íƒ€ì¼ë¦¬ì‹œ</option>
                            </optgroup>
                        </select>
                        <input type="color" id="text-color" class="form-control form-control-color" value="#000000">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="right-column">
        <div class="control-panel">
            <h3 class="fw-bold mb-1">{{ product.name }}</h3>
            <p class="text-muted mb-4 fs-5">{{ product.price|intcomma }}ì› ~</p>

            <button class="btn btn-outline-dark w-100 mb-4 py-2 fw-bold" onclick="openPreviewModal()">
                <i class="fas fa-expand me-2"></i>ì „ì²´ ë·°(4ë©´) í™•ì¸í•˜ê¸°
            </button>

            <h6 class="fw-bold pb-2 border-bottom border-dark mb-3">1. ì˜µì…˜ ì„ íƒ</h6>
            
            <div class="mb-4">
                <label class="fw-bold small text-secondary mb-1">â‘  ìƒ‰ìƒ ì„ íƒ</label>
                <select id="order-color-select" class="form-select">
                    {% if colors %}
                        {% for c in colors %}
                            <option value="{{ c.color_name }}">{{ c.color_name }}</option>
                        {% endfor %}
                    {% else %}
                        <option value="default">ê¸°ë³¸</option>
                    {% endif %}
                </select>
                <input type="hidden" name="color_selected" id="form-color-selected" value="{% if colors %}{{ colors.0.color_name }}{% else %}default{% endif %}">
            </div>

            <div class="mb-4">
                <label class="fw-bold small text-secondary mb-1">â‘¡ ì‘ì—… ìœ„ì¹˜ ì„ íƒ</label>
                <div class="view-controls">
                    <div class="view-btn active" onclick="changeView('front')"><img id="thumb-front" src=""><span>ì•ë©´</span></div>
                    <div class="view-btn" onclick="changeView('back')"><img id="thumb-back" src=""><span>ë’·ë©´</span></div>
                    <div class="view-btn" onclick="changeView('left')"><img id="thumb-left" src=""><span>ì™¼íŒ”</span></div>
                    <div class="view-btn" onclick="changeView('right')"><img id="thumb-right" src=""><span>ì˜¤ë¥¸íŒ”</span></div>
                </div>
            </div>

            <h6 class="fw-bold pb-2 border-bottom border-dark mb-3">2. ì‚¬ì´ì¦ˆ & ìˆ˜ëŸ‰</h6>
            <div class="mb-4 bg-light p-3 rounded" style="max-height: 250px; overflow-y: auto;">
                <table class="w-100 size-table">
                    {% for opt in product.options.all %}
                    <tr style="border-bottom: 1px solid #eee;">
                        <td class="py-2">
                            <span class="fw-bold">{{ opt.size }}</span>
                            <small class="text-muted ms-2">({{ opt.color }})</small>
                            
                            {% if opt.stock <= 0 %}
                                <span class="badge bg-danger ms-1">í’ˆì ˆ</span>
                            {% else %}
                                <span class="badge bg-secondary ms-1">ì¬ê³ : {{ opt.stock }}</span>
                            {% endif %}
                        </td>
                        <td class="text-end py-2">
                            <input type="number" min="0" value="0" 
                                max="{{ opt.stock }}" 
                                class="form-control d-inline-block text-center size-qty" 
                                style="width:70px" 
                                data-size="{{ opt.size }}" 
                                data-cost="0" 
                                onchange="calculateTotal()"
                                {% if opt.stock <= 0 %}disabled placeholder="X"{% endif %}>
                        </td>
                    </tr>
                    {% empty %}
                        <tr><td colspan="2" class="text-center py-3">ë“±ë¡ëœ ì‚¬ì´ì¦ˆ ì˜µì…˜ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
                    {% endfor %}
                </table>
            </div>

            <div class="d-flex justify-content-between align-items-center mb-4">
                <span class="fs-5 fw-bold">ì´ ê²¬ì </span>
                <span class="fs-3 fw-bold text-danger" id="total-price-display">0ì›</span>
            </div>

            <form id="quote-form" method="POST" action="{% url 'products:order_create' %}" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" name="product_name" value="{{ product.name }}">
                <input type="hidden" name="color_selected" id="form-color-selected-input">
                <input type="hidden" name="total_quantity" id="form-total-qty">
                <input type="hidden" name="total_price" id="form-total-price">
                <input type="hidden" name="size_detail_text" id="form-size-detail">
                <input type="hidden" name="tech_pack_data" id="form-tech-pack">
                
                <input type="hidden" name="captured_front" id="captured_front">
                <input type="hidden" name="captured_back" id="captured_back">
                <input type="hidden" name="captured_left" id="captured_left">
                <input type="hidden" name="captured_right" id="captured_right">
            
                <div class="mb-2"><input type="text" name="customer_name" class="form-control" placeholder="ì£¼ë¬¸ìëª… / ë‹¨ì²´ëª…" required></div>
                <div class="mb-2">
                    <input type="tel" name="phone" id="phone-input" class="form-control" placeholder="ì—°ë½ì²˜ (010-0000-0000)" maxlength="13" required>
                </div>
                <div class="mb-3"><input type="text" name="address" class="form-control" placeholder="ë°°ì†¡ì§€ ì£¼ì†Œ" required></div>
                <label>ì´ë©”ì¼ (ì£¼ë¬¸ ì•Œë¦¼ ìˆ˜ì‹ ìš©)</label>
                <input type="email" name="customer_email" class="form-control" placeholder="example@email.com" required>
                <div class="d-flex w-100 gap-2 mt-4"> <button type="submit" class="btn btn-warning flex-grow-1 py-3 text-white d-flex flex-column align-items-center justify-content-center" 
                            style="width: 50%; background:#ff6b00; border:none; border-radius: 15px; box-shadow: 0 4px 10px rgba(255, 107, 0, 0.2); transition: all 0.3s ease;" onclick="showLoading()">
                        <span class="fw-bold fs-5 mb-1">ê²¬ì  ì „ì†¡</span>
                        <span class="fw-normal" style="font-size: 12px; opacity: 0.9;">
                            (ê²°ì œ ì—†ì´ ì ‘ìˆ˜)
                        </span>
                    </button>

                    <button type="button" class="btn btn-cta-blue flex-grow-1 py-3 text-white d-flex flex-column align-items-center justify-content-center"
                            data-bs-toggle="modal" data-bs-target="#paymentModal"
                            style="width: 50%; border-radius: 15px; background-color: #004e92; box-shadow: 0 4px 10px rgba(0, 78, 146, 0.3);">
                        <span class="fw-bold fs-5 mb-1">ğŸ’³ ë°”ë¡œ ê²°ì œ</span>
                        <span class="fw-normal" style="font-size: 12px; opacity: 0.9;">
                            (PAYCO/ì¹´ì¹´ì˜¤/í† ìŠ¤)
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="previewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold">ì „ì²´ ë””ìì¸ í™•ì¸</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body bg-light">
                <div class="preview-grid-large">
                    <div class="preview-item-large"><h6>ì•ë©´</h6><div class="preview-shirt-wrap"><img id="prev-img-front" class="preview-shirt-img"><div id="preview-front" class="preview-print-area"></div></div></div>
                    <div class="preview-item-large"><h6>ë’·ë©´</h6><div class="preview-shirt-wrap"><img id="prev-img-back" class="preview-shirt-img"><div id="preview-back" class="preview-print-area"></div></div></div>
                    <div class="preview-item-large"><h6>ì™¼íŒ”</h6><div class="preview-shirt-wrap"><img id="prev-img-left" class="preview-shirt-img"><div id="preview-left" class="preview-print-area"></div></div></div>
                    <div class="preview-item-large"><h6>ì˜¤ë¥¸íŒ”</h6><div class="preview-shirt-wrap"><img id="prev-img-right" class="preview-shirt-img"><div id="preview-right" class="preview-print-area"></div></div></div>
                </div>
            </div>
            <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button></div>
        </div>
    </div>
</div>

<div id="obj-controls" style="display:none; position:absolute; z-index:1000; background:rgba(0,0,0,0.8); padding:5px; border-radius:5px; gap:5px;">
    <button class="btn btn-sm btn-primary ai-btn" onclick="runAI()">âœ¨ AI ëˆ„ë¼</button>
    <button class="btn btn-sm btn-success restore-btn" onclick="runRestore()" style="display:none;">â†© ë³µêµ¬</button>
    <button class="btn btn-sm btn-danger" onclick="runDelete()">ğŸ—‘ ì‚­ì œ</button>
</div>
<script src="https://cdn.iamport.kr/v1/iamport.js"></script>
<script>
    // [1] ì „ì—­ ë³€ìˆ˜
    let canvas;
    const PX_PER_CM = 12; // 1cm = 12px (600px = 50cm ê¸°ì¤€)
    const PRICE_S = 2300, PRICE_M = 4400, PRICE_L = 5500;
    const basePrice = {{ product.price }};
    let designStates = { 'front': null, 'back': null, 'left': null, 'right': null };
    let currentView = 'front';
    let currentColor = '{% if colors %}{{ colors.0.color_name }}{% else %}default{% endif %}';

    const printAreas = {
        'front': { top: '15%', left: '25%', width: '50%', height: '60%' },
        'back':  { top: '15%', left: '25%', width: '50%', height: '60%' },
        'left':  { top: '22%', left: '40%', width: '30%', height: '30%' },
        'right': { top: '22%', left: '40%', width: '30%', height: '30%' }
    };

    const mainImageUrl = "{% if product.image %}{{ product.image.url }}{% endif %}";
    const productData = {
        'default': { 'front': mainImageUrl, 'back': mainImageUrl, 'left': mainImageUrl, 'right': mainImageUrl },
        {% for c in colors %}
        '{{ c.color_name }}': {
            'front': "{% if c.image_front %}{{ c.image_front.url }}{% elif product.image %}{{ product.image.url }}{% endif %}",
            'back':  "{% if c.image_back %}{{ c.image_back.url }}{% elif product.image %}{{ product.image.url }}{% endif %}",
            'left':  "{% if c.image_left %}{{ c.image_left.url }}{% elif product.image %}{{ product.image.url }}{% endif %}",
            'right': "{% if c.image_right %}{{ c.image_right.url }}{% elif product.image %}{{ product.image.url }}{% endif %}"
        },
        {% endfor %}
    };

    // [2] ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸
    document.addEventListener('DOMContentLoaded', function() {
        // â˜… [í•´ê²° 4] ì¡°ì‘ í•¸ë“¤ ë””ìì¸ ê°œì„  (í¬ê³  ì˜ˆì˜ê²Œ)
        fabric.Object.prototype.set({
            transparentCorners: false, // ì±„ì›Œì§„ í•¸ë“¤
            cornerColor: '#ffffff',    // í°ìƒ‰
            cornerStrokeColor: '#333333', // ê²€ì€ í…Œë‘ë¦¬
            borderColor: '#333333',    // ë°•ìŠ¤ í…Œë‘ë¦¬
            cornerSize: 12,            // í•¸ë“¤ í¬ê¸° í‚¤ì›€ (ê¸°ì¡´ë³´ë‹¤ í¼)
            padding: 10,               // ì—¬ë°± í™•ë³´
            cornerStyle: 'circle'      // ë™ê·¸ë¼ë¯¸ ëª¨ì–‘
        });

        const wrapper = document.getElementById('print-area-wrapper');
        canvas = new fabric.Canvas('tshirt-canvas', {
            width: wrapper.clientWidth, height: wrapper.clientHeight, preserveObjectStacking: true
        });

        changeView('front');
        updateCanvasImages();
        document.getElementById('form-color-selected').value = currentColor;

        // ì´ë²¤íŠ¸ ì—°ê²°
        canvas.on('object:added', calculateTotal);
        canvas.on('object:modified', calculateTotal);
        canvas.on('object:removed', () => { 
            document.getElementById('obj-controls').style.display = 'none'; 
            calculateTotal(); 
        });
        
        // ë©”ë‰´ í‘œì‹œ ë° ìœ„ì¹˜ ì—…ë°ì´íŠ¸
        canvas.on('selection:created', showControls);
        canvas.on('selection:updated', showControls);
        canvas.on('object:moving', showControls);
        canvas.on('object:scaling', showControls);
        canvas.on('selection:cleared', () => document.getElementById('obj-controls').style.display = 'none');

        // í…ìŠ¤íŠ¸ í´ë¦­ ì‹œ ë„êµ¬ì°½ ë™ê¸°í™”
        canvas.on('selection:created', updateTools);
        canvas.on('selection:updated', updateTools);

        // ìƒ‰ìƒ ë³€ê²½
        document.getElementById('order-color-select').addEventListener('change', function() {
            currentColor = this.value;
            document.getElementById('form-color-selected').value = currentColor;
            updateCanvasImages();
        });

        // ì´ë¯¸ì§€ ì—…ë¡œë“œ
        document.getElementById('upload-btn').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('real-file-input').value = '';
            document.getElementById('real-file-input').click();
        });

        document.getElementById('real-file-input').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = function(f) {
                fabric.Image.fromURL(f.target.result, function(img) {
                    img.scaleToWidth(200);
                    canvas.add(img);
                    canvas.centerObject(img);
                    canvas.setActiveObject(img);
                    canvas.renderAll();
                });
            };
            reader.readAsDataURL(file);
        });

        // â˜… [í•´ê²° 1] ê¸€ê¼´ ë³€ê²½ (ë” ê°•ë ¥í•˜ê²Œ ì²˜ë¦¬)
        document.getElementById('font-select').addEventListener('change', function() {
            const obj = canvas.getActiveObject();
            if (obj && (obj.type === 'text' || obj.type === 'i-text')) {
                // ê°’ ì˜ˆ: "'Do Hyeon', sans-serif" -> "Do Hyeon"
                let fontName = this.value.split(',')[0]; 
                fontName = fontName.replace(/['"]/g, '').trim(); 
                
                obj.set("fontFamily", fontName);
                canvas.requestRenderAll();
            }
        });

        // í…ìŠ¤íŠ¸ ìƒ‰ìƒ ë³€ê²½
        document.getElementById('text-color').addEventListener('input', function() {
            const obj = canvas.getActiveObject();
            if (obj && (obj.type === 'text' || obj.type === 'i-text')) {
                obj.set('fill', this.value);
                canvas.requestRenderAll();
            }
        });

        // ê²°ì œ ë²„íŠ¼
        document.getElementById('start-payment-final').addEventListener('click', requestPay);
    });

    // [3] ê¸°ëŠ¥ í•¨ìˆ˜ë“¤
    
    // â˜… [í•´ê²° 2] ë²„íŠ¼ ë©”ë‰´ ìœ„ì¹˜ ê³ ì • (ê°ì²´ ì¤‘ì•™ ìƒë‹¨)
    function showControls() {
        const obj = canvas.getActiveObject();
        const controls = document.getElementById('obj-controls');
        
        if (!obj) { controls.style.display = 'none'; return; }

        const wrapper = document.querySelector('.canvas-wrapper');
        if (controls.parentElement !== wrapper) { wrapper.appendChild(controls); }

        const objRect = obj.getBoundingRect();
        
        // 1. ì¸ì‡„ì˜ì—­ì˜ í˜„ì¬ ìœ„ì¹˜ (px)
        const area = printAreas[currentView];
        const canvasOffsetLeft = (parseFloat(area.left) / 100) * 600;
        const canvasOffsetTop = (parseFloat(area.top) / 100) * 700;

        // 2. ë²„íŠ¼ ìœ„ì¹˜ ê³„ì‚° (ê°ì²´ ì •ì¤‘ì•™ ìœ„)
        // ê°ì²´ top + ìº”ë²„ìŠ¤ top - ë²„íŠ¼ ë†’ì´(ì•½ 45px)
        let topPos = canvasOffsetTop + objRect.top - 45;
        // ê°ì²´ left + ìº”ë²„ìŠ¤ left + (ê°ì²´ë„ˆë¹„ ì ˆë°˜) - (ë²„íŠ¼ë„ˆë¹„ ì ˆë°˜)
        let leftPos = canvasOffsetLeft + objRect.left + (objRect.width / 2) - (controls.offsetWidth / 2);

        // 3. í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì•„ë˜ë¡œ ë‚´ë¦¬ê¸°
        if (topPos < 0) { 
            topPos = canvasOffsetTop + objRect.top + objRect.height + 10; 
        }

        controls.style.top = topPos + 'px';
        controls.style.left = leftPos + 'px';
        controls.style.display = 'flex';
        controls.style.justifyContent = 'center';

        // ë²„íŠ¼ í‘œì‹œ ê´€ë¦¬
        const btnAI = controls.querySelector('.ai-btn');
        const btnRestore = controls.querySelector('.restore-btn');
        
        if (obj.type === 'image') {
            if (obj._originalSrc) {
                btnRestore.style.display = 'inline-block';
                btnAI.style.display = 'none';
            } else {
                btnAI.style.display = 'inline-block';
                btnRestore.style.display = 'none';
            }
        } else {
            btnAI.style.display = 'none';
            btnRestore.style.display = 'none';
        }
    }

    function updateTools() {
        const obj = canvas.getActiveObject();
        if (obj && (obj.type === 'text' || obj.type === 'i-text')) {
            document.getElementById('text-color').value = obj.fill;
            const select = document.getElementById('font-select');
            for (let i = 0; i < select.options.length; i++) {
                if (select.options[i].value.includes(obj.fontFamily)) {
                    select.selectedIndex = i;
                    break;
                }
            }
        }
    }

    function changeView(v) {
        designStates[currentView] = JSON.stringify(canvas.toJSON(['_originalSrc']));
        currentView = v; updateCanvasImages();
        
        const area = printAreas[v];
        const wrapper = document.getElementById('print-area-wrapper');
        wrapper.style.top = area.top; wrapper.style.left = area.left;
        wrapper.style.width = area.width; wrapper.style.height = area.height;
        
        canvas.setDimensions({width: wrapper.clientWidth, height: wrapper.clientHeight});
        canvas.clear();
        
        if(designStates[v]) canvas.loadFromJSON(designStates[v], () => { canvas.renderAll(); calculateTotal(); });
        
        document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
        document.querySelector(`.view-btn[onclick="changeView('${v}')"]`).classList.add('active');
    }

    function updateCanvasImages() {
        const set = productData[currentColor] || productData['default'];
        if(set[currentView]) document.getElementById('shirt-img').src = set[currentView];
        if(document.getElementById('thumb-front')) {
            ['front','back','left','right'].forEach(v => document.getElementById(`thumb-${v}`).src = set[v]);
        }
    }

    function addSticker(url) {
        fabric.Image.fromURL(url, (img) => {
            img.scaleToWidth(150);
            canvas.add(img);
            canvas.centerObject(img);
            canvas.setActiveObject(img);
        }, { crossOrigin: 'anonymous' });
    }

    function addText() {
        const input = document.getElementById('custom-text');
        const text = new fabric.Text(input.value || 'TEXT', {
            left: 100, top: 100, fontSize: 40, 
            fill: document.getElementById('text-color').value,
            fontFamily: 'Noto Sans KR'
        });
        canvas.add(text);
        canvas.centerObject(text);
        canvas.setActiveObject(text);
        input.value = '';
    }

    function runDelete() { 
        const obj = canvas.getActiveObject(); 
        if(obj) { canvas.remove(obj); document.getElementById('obj-controls').style.display = 'none'; calculateTotal(); }
    }

    // â˜… [í•´ê²° 3] AI ëˆ„ë¼ í›„ í¬ê¸° ìœ ì§€ ë¡œì§
    function runAI() {
        const obj = canvas.getActiveObject();
        if (!obj || obj.type !== 'image') return;
        
        const btn = document.querySelector('.ai-btn'); 
        const originalText = btn.innerText;
        btn.innerText = 'ì²˜ë¦¬ì¤‘..'; btn.disabled = true;
        
        // í˜„ì¬ ë³´ì´ëŠ” ë„ˆë¹„/ë†’ì´ ì €ì¥ (ì´ í¬ê¸°ë¡œ ë‹¤ì‹œ ë§ì¶œ ì˜ˆì •)
        const currentWidth = obj.getScaledWidth();
        
        if(!obj._originalSrc) obj._originalSrc = obj.toDataURL();
        const img = new Image(); img.src = obj.toDataURL();
        
        img.onload = () => {
            const c = document.createElement('canvas');
            const scale = Math.min(1, 800/img.width);
            c.width = img.width*scale; c.height = img.height*scale;
            c.getContext('2d').drawImage(img,0,0,c.width,c.height);
            
            fetch("/remove_background_ai/", {
                method: 'POST', body: JSON.stringify({image: c.toDataURL()}),
                headers: {'Content-Type': 'application/json', 'X-CSRFToken': '{{ csrf_token }}'}
            })
            .then(r => r.json())
            .then(d => {
                if(d.status === 'success') {
                    obj.setSrc(d.image, () => { 
                        // â˜… ì›ë˜ ë³´ë˜ í¬ê¸°ë¡œ ë³µêµ¬
                        obj.scaleToWidth(currentWidth);
                        canvas.renderAll(); 
                        
                        btn.style.display = 'none'; 
                        document.querySelector('.restore-btn').style.display = 'inline-block'; 
                    });
                } else {
                    alert(d.message);
                }
            })
            .finally(() => { btn.innerText = originalText; btn.disabled = false; });
        }
    }

    function runRestore() {
        const obj = canvas.getActiveObject();
        if(obj && obj._originalSrc) {
            // ë³µêµ¬í•  ë•Œë„ í¬ê¸° ìœ ì§€ ì‹œë„
            const currentWidth = obj.getScaledWidth();
            obj.setSrc(obj._originalSrc, () => { 
                obj.scaleToWidth(currentWidth);
                canvas.renderAll(); 
                document.querySelector('.ai-btn').style.display = 'inline-block'; 
                document.querySelector('.restore-btn').style.display = 'none'; 
            });
        }
    }

    // â˜… [í•´ê²° 5] ì‚¬ì´ì¦ˆ ì±…ì • ë¡œì§ ê°œì„  (getBoundingRect ì‚¬ìš©)
// [ìˆ˜ì •ëœ ê°€ê²© ê³„ì‚° ë¡œì§] ë©´ì  ë¹„ë¡€(S/M/L) + ê°œìˆ˜ ì¶”ê°€ ìš”ê¸ˆ(+1000ì›)
    function calculateTotal() {
        // 1. í˜„ì¬ ì‘ì—… ìƒíƒœ ì €ì¥
        designStates[currentView] = JSON.stringify(canvas.toJSON());
        
        // 2. ì˜· ê¸°ë³¸ ê°€ê²© + ìˆ˜ëŸ‰ í•©ì‚°
        let qty = 0; 
        let baseTotal = 0;
        document.querySelectorAll('.size-qty').forEach(el => { 
            const q = parseInt(el.value) || 0; 
            qty += q; 
            baseTotal += q * basePrice; 
        });

        // 3. ì¸ì‡„ë¹„ ê³„ì‚° (ë©´ì  + ê°œìˆ˜)
        let totalPrintCost = 0; 
        let details = [];

        ['front', 'back', 'left', 'right'].forEach(v => {
            if (!designStates[v]) return;
            
            // ì €ì¥ëœ ë°ì´í„° íŒŒì‹±
            const json = JSON.parse(designStates[v]);
            const objCount = json.objects.length; // ìš”ì†Œ(ë¡œê³ /ê¸€ì) ê°œìˆ˜ í™•ì¸
            
            if (objCount === 0) return; // ë””ìì¸ ì—†ìœ¼ë©´ íŒ¨ìŠ¤
            
            // (A) ë©´ì  ê³„ì‚° (Bounding Box)
            let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
            json.objects.forEach(o => {
                const w = o.width * o.scaleX;
                const h = o.height * o.scaleY;
                const l = o.left;
                const t = o.top;
                
                if (l < minX) minX = l;
                if (t < minY) minY = t;
                if (l + w > maxX) maxX = l + w;
                if (t + h > maxY) maxY = t + h;
            });

            // cm ë³€í™˜ (PX_PER_CM = 12)
            const widthCm = (maxX - minX) / PX_PER_CM;
            const heightCm = (maxY - minY) / PX_PER_CM;
            const maxSide = Math.max(widthCm, heightCm);
            
            // (B) ê¸°ë³¸ ë©´ì  ê°€ê²© ì±…ì •
            let baseCost = 0;
            let sizeLabel = "";
            if (maxSide <= 12) { baseCost = PRICE_S; sizeLabel = "ì†Œí˜•"; }      // 2300
            else if (maxSide <= 25) { baseCost = PRICE_M; sizeLabel = "ì¤‘í˜•"; } // 4400
            else { baseCost = PRICE_L; sizeLabel = "ëŒ€í˜•"; }                    // 5500
            
            // (C) ê°œìˆ˜ ì¶”ê°€ ìš”ê¸ˆ ê³„ì‚° (2ê°œì§¸ë¶€í„° ê°œë‹¹ 1,000ì› ì¶”ê°€)
            let extraCost = 0;
            if (objCount > 1) {
                extraCost = (objCount - 1) * 1000;
            }

            // í•´ë‹¹ ë©´ì˜ ìµœì¢… ì¸ì‡„ë¹„
            const viewTotal = baseCost + extraCost;
            totalPrintCost += viewTotal;
            
            // ìƒì„¸ ë‚´ì—­ ê¸°ë¡ (ì˜ˆ: [ì•ë©´] ì†Œí˜•(2300) + ì¶”ê°€1ê°œ(1000) = 3300ì›)
            let detailStr = `[${v}] ${sizeLabel}(${baseCost.toLocaleString()}ì›)`;
            if (extraCost > 0) {
                detailStr += ` + ì¶”ê°€${objCount-1}ê±´(${extraCost.toLocaleString()}ì›)`;
            }
            details.push(detailStr);
        });

        // 4. ìµœì¢… í•©ê³„ (ì˜·ê°€ê²© + (ì¸ì‡„ë¹„ * ìˆ˜ëŸ‰))
        // ì£¼ì˜: ì¸ì‡„ë¹„ëŠ” ì˜· 1ë²Œë‹¹ ê°€ê²©ì´ë¯€ë¡œ ìˆ˜ëŸ‰ì„ ê³±í•´ì•¼ í•¨
        const finalTotal = baseTotal + (totalPrintCost * qty);
        
        // 5. í™”ë©´ ë° í¼ ì—…ë°ì´íŠ¸
        document.getElementById('total-price-display').innerText = finalTotal.toLocaleString() + 'ì›';
        document.getElementById('form-total-qty').value = qty; 
        document.getElementById('form-total-price').value = finalTotal;
        document.getElementById('form-tech-pack').value = details.join('\n');
    }

    function openPreviewModal() { 
        designStates[currentView] = JSON.stringify(canvas.toJSON());
        const set = productData[currentColor] || productData['default'];
        const views = ['front', 'back', 'left', 'right'];
        
        const modal = new bootstrap.Modal(document.getElementById('previewModal'));
        modal.show();

        setTimeout(() => {
            views.forEach(v => {
                document.getElementById(`prev-img-${v}`).src = set[v];
                const wrapper = document.getElementById(`prev-img-${v}`).parentElement;
                const old = wrapper.querySelector('.preview-design-layer');
                if(old) old.remove();

                if(designStates[v]) {
                    const area = printAreas[v];
                    const c = document.createElement('canvas');
                    const wVal = parseFloat(area.width)/100;
                    const hVal = parseFloat(area.height)/100;
                    c.width = 600 * wVal; c.height = 700 * hVal;
                    
                    const fc = new fabric.Canvas(c);
                    fc.loadFromJSON(designStates[v], () => {
                        fc.renderAll();
                        const img = document.createElement('img');
                        img.className = 'preview-design-layer';
                        img.src = fc.toDataURL();
                        img.style.position = 'absolute';
                        img.style.top = area.top; img.style.left = area.left;
                        img.style.width = area.width; img.style.height = area.height;
                        img.style.pointerEvents = 'none';
                        wrapper.appendChild(img);
                    });
                }
            });
        }, 200);
    }

    function requestPay() {
        document.getElementById('quote-form').submit();
    }
</script>


<hr class="my-5 border-secondary">

<div class="container py-5">
    
    <div class="text-center mb-5">
        <h3 class="font-heavy mb-4">PRODUCT <span class="text-orange">DETAIL</span></h3>
        <p class="text-muted mb-4">ìƒí’ˆ ìƒì„¸ ì •ë³´ ë° ì‚¬ì´ì¦ˆ ê°€ì´ë“œ</p>
        
        <div class="bg-white p-3 rounded border" style="min-height: 500px;">
            {% if product.detail_image %}
                <img src="{{ product.detail_image.url }}" class="img-fluid" alt="ìƒì„¸ í˜ì´ì§€" style="max-width: 100%;">
            {% else %}
                <img src="{{ product.image.url }}" class="img-fluid" alt="ê¸°ë³¸ ì´ë¯¸ì§€" style="max-width: 800px;">
            {% endif %}
        </div>
    </div>

    <div class="review-section mt-5">
        <h3 class="font-heavy mb-4">REVIEWS <span class="text-orange">({{ reviews.count }})</span></h3>
        
        <div class="review-list">
            {% for review in reviews %}
            <div class="card mb-3 border-0 bg-light rounded-4">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between mb-2">
                        <div>
                            <span class="fw-bold">{{ review.user.username }}</span>
                            <span class="text-warning ms-2">
                                {% if review.rating == 5 %}â­â­â­â­â­
                                {% elif review.rating == 4 %}â­â­â­â­
                                {% elif review.rating == 3 %}â­â­â­
                                {% else %}â­â­{% endif %}
                            </span>
                        </div>
                        <small class="text-muted">{{ review.created_at|date:"Y.m.d" }}</small>
                    </div>
                    
                    <p class="text-secondary mb-2">{{ review.content|linebreaksbr }}</p>
                    
                    {% if review.image %}
                    <div class="mt-2">
                        <img src="{{ review.image.url }}" alt="Review Image" class="img-fluid rounded" style="max-width: 150px;">
                    </div>
                    {% endif %}
                </div>
            </div>
            {% empty %}
            <div class="text-center py-5 border rounded bg-light">
                <p class="text-muted mb-0">ì•„ì§ ì‘ì„±ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
            {% endfor %}
        </div>
    </div>

</div>
<div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true" style="z-index: 1060;">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-radius: 20px; border: none; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
            
            <div class="modal-header border-0 bg-light p-4">
                <div>
                    <h5 class="modal-title fw-bold text-dark" id="paymentModalLabel">ê²°ì œ ìˆ˜ë‹¨ ì„ íƒ</h5>
                    <p class="text-muted small mb-0">ì›í•˜ì‹œëŠ” ê²°ì œ ë°©ë²•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <div class="modal-body p-4">
                <div class="d-grid gap-3">
                    <label class="card p-3 border hover-shadow cursor-pointer position-relative" style="cursor: pointer; border-radius: 12px; transition: 0.2s;">
                        <div class="d-flex align-items-center">
                            <input class="form-check-input me-3" type="radio" name="pg_modal_select" value="payco" style="transform: scale(1.3); border-color: #FA2828;">
                            <div>
                                <span class="fw-bold d-block text-dark" style="font-size: 1.1rem;">ğŸ”´ í˜ì´ì½”</span>
                                <span class="text-muted small">PAYCO ê°„í¸ê²°ì œ</span>
                            </div>
                        </div>
                    </label>

                    <label class="card p-3 border hover-shadow cursor-pointer position-relative" style="cursor: pointer; border-radius: 12px; transition: 0.2s;">
                        <div class="d-flex align-items-center">
                            <input class="form-check-input me-3" type="radio" name="pg_modal_select" value="kakaopay" style="transform: scale(1.3); border-color: #F7E600;">
                            <div>
                                <span class="fw-bold d-block text-dark" style="font-size: 1.1rem;">ğŸŸ¡ ì¹´ì¹´ì˜¤í˜ì´</span>
                                <span class="text-muted small">ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ê°„í¸ ê²°ì œ</span>
                            </div>
                        </div>
                    </label>

                    <label class="card p-3 border hover-shadow cursor-pointer position-relative" style="cursor: pointer; border-radius: 12px; transition: 0.2s;">
                        <div class="d-flex align-items-center">
                            <input class="form-check-input me-3" type="radio" name="pg_modal_select" value="tosspayments" style="transform: scale(1.3); border-color: #0064FF;">
                            <div>
                                <span class="fw-bold d-block text-dark" style="font-size: 1.1rem;">ğŸ”µ í† ìŠ¤í˜ì´</span>
                                <span class="text-muted small">í† ìŠ¤ ì•±ìœ¼ë¡œ ê²°ì œ</span>
                            </div>
                        </div>
                    </label>
                </div>
            </div>
            
            <div class="modal-footer border-0 p-4 pt-0">
                <div class="row w-100 g-2">
                    <div class="col-4">
                        <button type="button" class="btn btn-light w-100 py-3 fw-bold" data-bs-dismiss="modal" style="border-radius: 12px; color: #666;">ì·¨ì†Œ</button>
                    </div>
                    <div class="col-8">
                        <button type="button" id="start-payment-final" class="btn btn-primary w-100 py-3 fw-bold" style="border-radius: 12px; background-color: #004e92; border: none;">
                            ê²°ì œ ì§„í–‰í•˜ê¸°
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}