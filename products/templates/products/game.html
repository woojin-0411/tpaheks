{% extends "products/base.html" %}
{% load static %}

{% block title %}SPEED RUN | TR Clothing Store{% endblock %}

{% block content %}
<style>
    body { background-color: #111; color: white; touch-action: manipulation; /* ëª¨ë°”ì¼ ë”ë¸”íƒ­ í™•ëŒ€ ë°©ì§€ */ }
    
    .game-container {
        min-height: 80vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        position: relative;
        overflow: hidden;
    }

    /* íƒ€ì´í‹€ ë° íƒ€ì´ë¨¸ */
    .game-header { margin-bottom: 30px; }
    .game-title { font-family: 'Holtwood One SC', serif; font-size: 3rem; color: #ff6b00; margin-bottom: 10px; }
    .timer { font-family: 'Courier New', monospace; font-size: 4rem; font-weight: bold; color: #fff; }
    
    /* íŠ¸ë™ ë° ìºë¦­í„° */
    .track-container {
        width: 90%;
        max-width: 800px;
        height: 150px;
        border-bottom: 5px solid #555;
        position: relative;
        margin-bottom: 50px;
        display: flex;
        align-items: flex-end;
    }
    
    /* ê²°ìŠ¹ì„  */
    .finish-line {
        position: absolute;
        right: 0;
        bottom: 0;
        width: 10px;
        height: 100%;
        background: repeating-linear-gradient(
            45deg,
            #fff,
            #fff 10px,
            #000 10px,
            #000 20px
        );
        z-index: 1;
    }

    /* ë‹¬ë¦¬ëŠ” ìºë¦­í„° (ë°”ëŒë§‰ì´ ì•„ì´ì½˜) */
    .runner {
        position: absolute;
        left: 0;
        bottom: 0;
        width: 80px;
        height: 80px;
        font-size: 60px;
        transition: left 0.1s linear;
        z-index: 10;
        /* ë‹¬ë¦¬ëŠ” ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ (í”ë“¤ë¦¼) */
        transform-origin: bottom center;
    }
    .runner.running {
        animation: runShake 0.2s infinite;
    }
    @keyframes runShake {
        0% { transform: rotate(0deg); }
        25% { transform: rotate(5deg); }
        50% { transform: rotate(0deg); }
        75% { transform: rotate(-5deg); }
        100% { transform: rotate(0deg); }
    }

    /* ì—°íƒ€ ë²„íŠ¼ */
    .tap-btn {
        width: 200px;
        height: 200px;
        border-radius: 50%;
        background: radial-gradient(circle, #ff8a00 0%, #ff6b00 100%);
        border: 10px solid #c94600;
        color: white;
        font-family: 'Holtwood One SC', serif;
        font-size: 2.5rem;
        cursor: pointer;
        box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        transition: transform 0.1s;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
    }
    .tap-btn:active { transform: scale(0.95); background: #e65c00; }

    /* ê²°ê³¼ ëª¨ë‹¬ (ì„±ê³µ/ì‹¤íŒ¨) */
    .result-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.9);
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        z-index: 9999;
    }
    .result-box {
        background: #222; border: 2px solid #ff6b00; padding: 40px; border-radius: 20px;
        text-align: center; max-width: 90%; width: 400px;
    }
    .coupon-code {
        background: #333; padding: 15px; margin: 20px 0;
        font-size: 1.5rem; font-weight: bold; color: #ff6b00; border: 1px dashed #777;
    }

    .d-none { display: none !important; }
</style>

<div class="container game-container">
    
    <div class="game-header">
        <h1 class="game-title">100M SPRINT</h1>
        <p class="text-white-50">ì œí•œì‹œê°„ 12ì´ˆ! ë²„íŠ¼ì„ ì—°íƒ€í•˜ì„¸ìš”!</p>
        <div id="timer" class="timer">12.00</div>
    </div>

    <div class="track-container">
        <div class="finish-line"></div>
        <div id="runner" class="runner">ğŸƒ</div>
    </div>

    <div id="start-area">
        <button class="btn btn-lg btn-outline-light px-5 py-3 fw-bold" onclick="startGame()">START GAME</button>
    </div>

    <div id="game-area" class="d-none">
        <button id="tap-btn" class="tap-btn" onmousedown="tap()" ontouchstart="tap()">TAP!</button>
        <p class="mt-3 text-white-50">PC: Spacebar / Mobile: Touch</p>
    </div>

</div>

<div id="result-screen" class="result-overlay d-none">
    <div class="result-box">
        <h2 id="result-title" class="game-title">SUCCESS!</h2>
        <p id="result-msg" class="text-white">ì¶•í•˜í•©ë‹ˆë‹¤! ë¯¸ì…˜ ì„±ê³µ!</p>
        
        <div id="coupon-area" class="d-none">
            <div class="coupon-code">CODE: TR-FAST-10</div>
            <p class="text-muted small">ìº¡ì²˜í•˜ê±°ë‚˜ ì½”ë“œë¥¼ ë³µì‚¬í•˜ì„¸ìš”.</p>
        </div>

        <button class="btn btn-light mt-3 fw-bold" onclick="location.reload()">TRY AGAIN</button>
        <a href="{% url 'products:shop' %}" class="btn btn-outline-secondary mt-3">BACK TO SHOP</a>
    </div>
</div>

<script>
    let distance = 0; // ì§„í–‰ë„ (0 ~ 100%)
    let timeLeft = 12.00; // ì œí•œ ì‹œê°„
    let gameInterval;
    let isPlaying = false;
    
    const runner = document.getElementById('runner');
    const timerEl = document.getElementById('timer');
    const startArea = document.getElementById('start-area');
    const gameArea = document.getElementById('game-area');
    const resultScreen = document.getElementById('result-screen');

    // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ (ìŠ¤í˜ì´ìŠ¤ë°”)
    document.addEventListener('keydown', function(event) {
        if (isPlaying && event.code === 'Space') {
            tap();
        }
    });

    function startGame() {
        isPlaying = true;
        startArea.classList.add('d-none');
        gameArea.classList.remove('d-none');
        runner.classList.add('running');

        // íƒ€ì´ë¨¸ ì‹œì‘
        gameInterval = setInterval(() => {
            timeLeft -= 0.01;
            timerEl.innerText = timeLeft.toFixed(2);

            if (timeLeft <= 0) {
                endGame(false); // ì‹œê°„ ì´ˆê³¼ (ì‹¤íŒ¨)
            }
        }, 10);
    }

    function tap() {
        if (!isPlaying) return;

        // í•œ ë²ˆ íƒ­í•  ë•Œë§ˆë‹¤ ë‚˜ì•„ê°€ëŠ” ê±°ë¦¬ (ë‚œì´ë„ ì¡°ì ˆ: ì´ ìˆ«ìë¥¼ ë°”ê¾¸ì„¸ìš”)
        distance += 2.5; 
        
        // ìºë¦­í„° ì´ë™
        runner.style.left = distance + '%';

        // ìŠ¹ë¦¬ ì¡°ê±´ ì²´í¬
        if (distance >= 92) { // 92% ì¯¤ ê°€ë©´ ë„ì°©í•œ ê±¸ë¡œ (ìºë¦­í„° ë„ˆë¹„ ê³ ë ¤)
            endGame(true); // ì„±ê³µ
        }
    }

    function endGame(isSuccess) {
        isPlaying = false;
        clearInterval(gameInterval);
        runner.classList.remove('running');
        
        resultScreen.classList.remove('d-none');

        if (isSuccess) {
            document.getElementById('result-title').innerText = "MISSION CLEAR!";
            document.getElementById('result-title').style.color = "#ff6b00";
            document.getElementById('result-msg').innerText = `ê¸°ë¡: ${(12 - timeLeft).toFixed(2)}ì´ˆ! ëŒ€ë‹¨í•´ìš”!`;
            document.getElementById('coupon-area').classList.remove('d-none');
        } else {
            document.getElementById('result-title').innerText = "FAILED...";
            document.getElementById('result-title').style.color = "#555";
            document.getElementById('result-msg').innerText = "ì‹œê°„ì´ ë¶€ì¡±í•´ìš”! ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”.";
            document.getElementById('coupon-area').classList.add('d-none');
        }
    }
</script>
{% endblock %}